<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­Ù„â€ŒÚ©Ù†Ù†Ø¯Ù‡ Ø¯Ùˆ ÙØ§Ø²ÛŒ Revised Simplex</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/mathjs@11.8.0/lib/browser/math.min.js"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            }
        };
    </script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            max-width: 1400px;
        }
        h1 {
            color: #764ba2;
            font-weight: bold;
            text-align: center;
            margin-bottom: 30px;
        }
        .nav-tabs {
            border-bottom: 2px solid #764ba2;
            margin-bottom: 25px;
        }
        .nav-tabs .nav-link {
            color: #764ba2;
            font-weight: 600;
            border: none;
            border-bottom: 3px solid transparent;
        }
        .nav-tabs .nav-link.active {
            color: #764ba2;
            background: transparent;
            border-bottom: 3px solid #764ba2;
        }
        .input-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .matrix-input {
            display: grid;
            gap: 5px;
            margin: 10px 0;
            overflow-x: auto;
        }
        .table-responsive {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        .matrix-input input {
            width: 70px;
            text-align: center;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .btn-solve {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: bold;
            padding: 12px 40px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            margin: 20px auto;
            display: block;
        }
        .btn-solve:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(118, 75, 162, 0.4);
        }
        .loading {
            display: none;
            text-align: center;
            padding: 30px;
            background: white;
            border-radius: 10px;
            margin: 20px 0;
        }
        .loading.active {
            display: block;
        }
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #e9ecef;
            border-top-color: #764ba2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .step-box {
            background: #fff;
            border: 2px solid #764ba2;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .step-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #764ba2;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .step-number {
            background: #764ba2;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }
        .phase-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin: 30px 0 20px 0;
            box-shadow: 0 5px 20px rgba(118, 75, 162, 0.3);
        }
        .math-block {
            background: #f8f9fa;
            border-right: 4px solid #764ba2;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            direction: ltr;
            text-align: center;
            overflow-x: auto;
        }
        .math-block.success {
            background: #d4edda;
            border-color: #28a745;
        }
        .math-block.warning {
            background: #fff3cd;
            border-color: #ffc107;
        }
        .math-block.highlight {
            background: #e7f3ff;
            border-color: #2196f3;
        }
        .result-box {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin: 30px 0;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .result-box h3 {
            font-size: 2rem;
            margin-bottom: 20px;
        }
        .result-box.infeasible-box {
            background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
        }
        .ratio-table {
            width: 100%;
            margin: 15px 0;
            border-collapse: collapse;
        }
        .ratio-table th, .ratio-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }
        .ratio-table th {
            background: #764ba2;
            color: white;
            font-weight: bold;
        }
        .ratio-table tr.selected {
            background: #d4edda;
            font-weight: bold;
        }
        .ratio-table tr.invalid {
            background: #f8d7da;
            color: #999;
        }
        .explanation-text {
            color: #555;
            font-size: 0.95rem;
            line-height: 1.6;
            margin: 10px 0;
        }
        .leaving-var {
            color: #e74c3c;
            font-weight: bold;
        }
        .entering-var {
            color: #27ae60;
            font-weight: bold;
        }
        .basis-selector {
            margin: 15px 0;
        }
        .basis-selector label {
            display: inline-block;
            margin: 5px 10px;
            padding: 8px 15px;
            background: #e9ecef;
            border-radius: 5px;
            cursor: pointer;
        }
        .basis-selector input[type="checkbox"]:checked + span {
            background: #28a745;
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
        }
        .example-btn {
            background: linear-gradient(135deg, #ed8936, #dd6b20);
            border: none;
            border-radius: 8px;
            padding: 8px 20px;
            font-weight: 600;
            color: white;
            margin: 5px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        .example-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 3px 10px rgba(237, 137, 54, 0.4);
        }
        .examples-section {
            background: #fff3e0;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border: 2px dashed #ff9800;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ Ø­Ù„â€ŒÚ©Ù†Ù†Ø¯Ù‡ Ø¯Ùˆ ÙØ§Ø²ÛŒ Revised Simplex</h1>
        <div style="text-align:center;margin:15px 0;">
            <a href="https://or344.github.io/symplex/" style="display:inline-block;background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);color:white;padding:12px 25px;border-radius:8px;text-decoration:none;font-weight:600;">
                ğŸ“Š Ø­Ù„ Ø¨Ù‡ Ø±ÙˆØ´ M Ø¨Ø²Ø±Ú¯
            </a>
        </div>
        
        <ul class="nav nav-tabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="auto-tab" data-bs-toggle="tab" data-bs-target="#auto-mode" type="button">Ø­Ø§Ù„Øª Ø®ÙˆØ¯Ú©Ø§Ø± (Ø¯Ùˆ ÙØ§Ø²)</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="manual-tab" data-bs-toggle="tab" data-bs-target="#manual-mode" type="button">Ø­Ø§Ù„Øª Ø¯Ø³ØªÛŒ (Ø´Ø±ÙˆØ¹ Ø§Ø² ÙØ§Ø² Û²)</button>
            </li>
        </ul>

        <div class="tab-content">
            <!-- AUTO MODE -->
            <div class="tab-pane fade show active" id="auto-mode">
                <div class="input-section">
                    <h4>ÙˆØ±ÙˆØ¯ÛŒ Ù…Ø³Ø¦Ù„Ù‡</h4>
                    <div class="row">
                        <div class="col-md-6">
                            <label>ØªØ¹Ø¯Ø§Ø¯ Ù…ØªØºÛŒØ±Ù‡Ø§:</label>
                            <input type="number" id="auto-vars" class="form-control" value="2" min="1">
                        </div>
                        <div class="col-md-6">
                            <label>ØªØ¹Ø¯Ø§Ø¯ Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§:</label>
                            <input type="number" id="auto-constraints" class="form-control" value="2" min="1">
                        </div>
                    </div>
                    <button class="btn btn-primary mt-3" onclick="generateAutoInputs()">Ø§ÛŒØ¬Ø§Ø¯ Ø¬Ø¯Ø§ÙˆÙ„ ÙˆØ±ÙˆØ¯ÛŒ</button>
                    <div class="examples-section mt-3">
                        <h6 style="color:#f57c00;font-weight:bold;margin-bottom:10px;">ğŸ’¡ Ù…Ø«Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ø¢Ù…Ø§Ø¯Ù‡:</h6>
                        <button class="example-btn" onclick="loadAutoExample1()">Ù…Ø«Ø§Ù„ Û±: Ù…Ø­Ø¯ÙˆØ¯ÛŒØª &ge; (Ù†ÛŒØ§Ø² Ø¨Ù‡ ÙØ§Ø² Û±)</button>
                        <button class="example-btn" onclick="loadAutoExample2()">Ù…Ø«Ø§Ù„ Û²: Ù…Ø­Ø¯ÙˆØ¯ÛŒØª &le; (Ù…Ø³ØªÙ‚ÛŒÙ… ÙØ§Ø² Û²)</button>
                        <button class="example-btn" onclick="loadAutoExample3()">Ù…Ø«Ø§Ù„ Û³: ØªØ±Ú©ÛŒØ¨ÛŒ (ÙØ§Ø² Û± Ùˆ Û²)</button>
                    </div>
                    <div id="auto-inputs"></div>
                </div>
                <button class="btn-solve" onclick="solveAuto()">Ø­Ù„ Ø¨Ø§ Ø±ÙˆØ´ Ø¯Ùˆ ÙØ§Ø²ÛŒ</button>
                <div class="loading" id="auto-loading">
                    <div class="spinner"></div>
                    <p>Ø¯Ø± Ø­Ø§Ù„ Ø­Ù„ Ù…Ø³Ø¦Ù„Ù‡...</p>
                </div>
                <div id="auto-output"></div>
            </div>

            <!-- MANUAL MODE -->
            <div class="tab-pane fade" id="manual-mode">
                <div class="input-section">
                    <h4>ÙˆØ±ÙˆØ¯ÛŒ Ù…Ø³Ø¦Ù„Ù‡ (ÙØ§Ø² Û² Ù…Ø³ØªÙ‚ÛŒÙ…)</h4>
                    <div class="row">
                        <div class="col-md-6">
                            <label>ØªØ¹Ø¯Ø§Ø¯ Ù…ØªØºÛŒØ±Ù‡Ø§ (Ø´Ø§Ù…Ù„ slack/surplus):</label>
                            <input type="number" id="manual-vars" class="form-control" value="4" min="1" onchange="generateManualInputs()">
                        </div>
                        <div class="col-md-6">
                            <label>ØªØ¹Ø¯Ø§Ø¯ Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§:</label>
                            <input type="number" id="manual-constraints" class="form-control" value="2" min="1" onchange="generateManualInputs()">
                        </div>
                    </div>
                    <button class="btn btn-primary mt-3" onclick="generateManualInputs()">Ø§ÛŒØ¬Ø§Ø¯ Ø¬Ø¯Ø§ÙˆÙ„ ÙˆØ±ÙˆØ¯ÛŒ</button>
                    <div class="examples-section mt-3">
                        <h6 style="color:#f57c00;font-weight:bold;margin-bottom:10px;">ğŸ’¡ Ù…Ø«Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ø¢Ù…Ø§Ø¯Ù‡:</h6>
                        <button class="example-btn" onclick="loadManualExample1()">Ù…Ø«Ø§Ù„ Û±: Ù¾Ø§ÛŒÙ‡ Ø§ÙˆÙ„ÛŒÙ‡ Ø³Ø§Ø¯Ù‡</button>
                        <button class="example-btn" onclick="loadManualExample2()">Ù…Ø«Ø§Ù„ Û²: Ù¾Ø§ÛŒÙ‡ Ù¾ÛŒÚ†ÛŒØ¯Ù‡â€ŒØªØ±</button>
                    </div>
                    <div id="manual-inputs"></div>
                </div>
                <button class="btn-solve" onclick="solveManual()">Ø´Ø±ÙˆØ¹ ÙØ§Ø² Û²</button>
                <div class="loading" id="manual-loading">
                    <div class="spinner"></div>
                    <p>Ø¯Ø± Ø­Ø§Ù„ Ø­Ù„ Ù…Ø³Ø¦Ù„Ù‡...</p>
                </div>
                <div id="manual-output"></div>
            </div>
        </div>
    </div>

    <footer style="margin-top:60px;padding:30px;text-align:center;background-color:#f8f9fa;border-top:1px solid #dee2e6;font-size:0.95rem;color:#666;">
        <p style="margin:0;"><strong>Ø­Ù„â€ŒÚ©Ù†Ù†Ø¯Ù‡ Ø±ÙˆØ´ Two-Phase Revised Simplex</strong></p>
        <p style="margin:8px 0 0 0;">Ø¯Ø±Ø³ ØªØ­Ù‚ÛŒÙ‚ Ø¯Ø± Ø¹Ù…Ù„ÛŒØ§Øª Û± - Ø§Ø³ØªØ§Ø¯ Ø®Ø³Ø±ÙˆÛŒ<strong></strong></p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const EPSILON = 1e-9;

        // ØªØ¨Ø¯ÛŒÙ„ Ø§Ø¹Ø¯Ø§Ø¯ ÙØ§Ø±Ø³ÛŒ Ø¨Ù‡ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ
        function persianToEnglish(str) {
            const persianNumbers = ['Û°','Û±','Û²','Û³','Û´','Ûµ','Û¶','Û·','Û¸','Û¹'];
            const arabicNumbers  = ['Ù ','Ù¡','Ù¢','Ù£','Ù¤','Ù¥','Ù¦','Ù§','Ù¨','Ù©'];
            const englishNumbers = ['0','1','2','3','4','5','6','7','8','9'];
            
            let result = str.toString();
            for (let i = 0; i < 10; i++) {
                result = result.replace(new RegExp(persianNumbers[i], 'g'), englishNumbers[i]);
                result = result.replace(new RegExp(arabicNumbers[i], 'g'), englishNumbers[i]);
            }
            return result;
        }

        // Ø®ÙˆØ§Ù†Ø¯Ù† Ù…Ù‚Ø¯Ø§Ø± Ø¹Ø¯Ø¯ÛŒ Ø¨Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ ÙØ§Ø±Ø³ÛŒ
        function getNumValue(id) {
            const val = document.getElementById(id).value;
            return parseFloat(persianToEnglish(val)) || 0;
        }

        // Smart Number Formatter with LaTeX Fraction Rendering
        function formatNum(num, precision = 4) {
            // Ø§Ú¯Ø± Ø¢Ø±Ø§ÛŒÙ‡ Ø§Ø³ØªØŒ Ø§ÙˆÙ„ÛŒÙ† Ø¹Ù†ØµØ± Ø±Ø§ Ø¨Ú¯ÛŒØ±
            if (Array.isArray(num)) {
                num = num[0];
            }
            
            // Ø§Ú¯Ø± Ø¹Ø¯Ø¯ Ù†ÛŒØ³ØªØŒ Ø¨Ù‡ Ø¹Ø¯Ø¯ ØªØ¨Ø¯ÛŒÙ„ Ú©Ù†
            if (typeof num !== 'number') {
                num = parseFloat(num) || 0;
            }
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ù†Ø²Ø¯ÛŒÚ© Ø¨Ù‡ ØµÙØ±
            if (Math.abs(num) < EPSILON) return "0";
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¯Ø¯ ØµØ­ÛŒØ­ Ø¨ÙˆØ¯Ù†
            if (Math.abs(num - Math.round(num)) < EPSILON) {
                return Math.round(num).toString();
            }
            
            // ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ Ú©Ø³Ø± Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² math.js
            try {
                const frac = math.fraction(num);
                const n = frac.n; // ØµÙˆØ±Øª Ú©Ø³Ø±
                const d = frac.d; // Ù…Ø®Ø±Ø¬ Ú©Ø³Ø±
                
                // Ø§Ú¯Ø± Ù…Ø®Ø±Ø¬ 1 Ø§Ø³ØªØŒ Ø¹Ø¯Ø¯ ØµØ­ÛŒØ­ Ø§Ø³Øª
                if (d === 1) {
                    return n.toString();
                }
                
                // Ù…Ø¯ÛŒØ±ÛŒØª Ø¹Ù„Ø§Ù…Øª Ù…Ù†ÙÛŒ
                if (n < 0) {
                    return `-\\frac{${Math.abs(n)}}{${d}}`;
                } else {
                    return `\\frac{${n}}{${d}}`;
                }
            } catch (e) {
                // Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§ØŒ Ø§Ø² ÙØ±Ù…Øª Ø§Ø¹Ø´Ø§Ø±ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†
                return num.toFixed(precision).replace(/\.?0+$/, "");
            }
        }

        function vec2latex(v) {
            return "\\begin{bmatrix}" + v.map(x => formatNum(x)).join("\\\\") + "\\end{bmatrix}";
        }

        function mat2latex(m) {
            return "\\begin{bmatrix}" + m.map(row => row.map(x => formatNum(x)).join("&")).join("\\\\") + "\\end{bmatrix}";
        }

        function getCol(A, j) {
            return A.map(row => row[j]);
        }

        // ============ AUTO MODE ============
        function generateAutoInputs() {
            const nVars = parseInt(document.getElementById('auto-vars').value);
            const nCons = parseInt(document.getElementById('auto-constraints').value);
            
            let html = '<h5 class="mt-4">Ù†ÙˆØ¹ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ:</h5>';
            html += '<div class="mb-3">';
            html += '<label class="me-3"><input type="radio" name="auto-objtype" value="max" checked> Ù…Ø§Ú©Ø²ÛŒÙ…Ù…</label>';
            html += '<label><input type="radio" name="auto-objtype" value="min"> Ù…ÛŒÙ†ÛŒÙ…Ù…</label>';
            html += '</div>';
            
            html += '<h5 class="mt-3">Ø¶Ø±Ø§ÛŒØ¨ ØªØ§Ø¨Ø¹ Ù‡Ø¯Ù (c):</h5>';
            html += '<div class="matrix-input" style="grid-template-columns: repeat(' + nVars + ', 70px);direction:ltr;">';
            for (let j = 0; j < nVars; j++) {
                html += `<div style="text-align:center;">`;
                html += `<label style="font-size:0.9rem;color:#764ba2;font-weight:600;display:block;margin-bottom:5px;">x<sub>${j+1}</sub></label>`;
                html += `<input type="number" id="auto-c${j}" value="0" step="any" style="text-align:center;">`;
                html += `</div>`;
            }
            html += '</div>';

            html += '<h5 class="mt-3">Ù…Ø§ØªØ±ÛŒØ³ Ø¶Ø±Ø§ÛŒØ¨ (A) Ùˆ Ø¨Ø±Ø¯Ø§Ø± Ø±Ø§Ø³Øª (b):</h5>';
            html += '<div class="table-responsive" style="direction:ltr;">';
            html += '<table class="table table-bordered"><thead><tr>';
            for (let j = 0; j < nVars; j++) html += `<th>x${j+1}</th>`;
            html += '<th>Ù†ÙˆØ¹</th><th>b</th></tr></thead><tbody>';
            
            for (let i = 0; i < nCons; i++) {
                html += '<tr>';
                for (let j = 0; j < nVars; j++) {
                    html += `<td><input type="number" id="auto-a${i}_${j}" value="0" step="any" style="width:60px;text-align:center;"></td>`;
                }
                html += `<td><select id="auto-type${i}" class="form-select" style="width:80px;">
                    <option value="<=">&le;</option>
                    <option value=">=">&ge;</option>
                    <option value="=">=</option>
                </select></td>`;
                html += `<td><input type="number" id="auto-b${i}" value="0" step="any" style="width:60px;text-align:center;"></td>`;
                html += '</tr>';
            }
            html += '</tbody></table></div>';

            document.getElementById('auto-inputs').innerHTML = html;
        }

        function solveAuto() {
            document.getElementById('auto-loading').classList.add('active');
            document.getElementById('auto-output').innerHTML = '';
            
            setTimeout(() => {
                try {
                    const nVars = parseInt(document.getElementById('auto-vars').value);
                    const nCons = parseInt(document.getElementById('auto-constraints').value);
                    const objType = document.querySelector('input[name="auto-objtype"]:checked').value;

                    const c = [];
                    for (let j = 0; j < nVars; j++) {
                        c.push(getNumValue(`auto-c${j}`));
                    }

                    const A = [];
                    const b = [];
                    const types = [];
                    for (let i = 0; i < nCons; i++) {
                        const row = [];
                        for (let j = 0; j < nVars; j++) {
                            row.push(getNumValue(`auto-a${i}_${j}`));
                        }
                        A.push(row);
                        b.push(getNumValue(`auto-b${i}`));
                        types.push(document.getElementById(`auto-type${i}`).value);
                    }

                    const result = twoPhaseRevised(A, b, c, types, objType);
                    document.getElementById('auto-output').innerHTML = result;
                    MathJax.typesetPromise();
                } catch (error) {
                    document.getElementById('auto-output').innerHTML = 
                        `<div class="alert alert-danger">Ø®Ø·Ø§: ${error.message}<br><pre>${error.stack}</pre></div>`;
                }
                document.getElementById('auto-loading').classList.remove('active');
            }, 100);
        }

        // ============ MANUAL MODE ============
        function generateManualInputs() {
            const nVars = parseInt(document.getElementById('manual-vars').value);
            const nCons = parseInt(document.getElementById('manual-constraints').value);
            
            let html = '<h5 class="mt-4">Ù†ÙˆØ¹ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ:</h5>';
            html += '<div class="mb-3">';
            html += '<label class="me-3"><input type="radio" name="manual-objtype" value="max" checked> Ù…Ø§Ú©Ø²ÛŒÙ…Ù…</label>';
            html += '<label><input type="radio" name="manual-objtype" value="min"> Ù…ÛŒÙ†ÛŒÙ…Ù…</label>';
            html += '</div>';
            
            html += '<h5 class="mt-3">Ø¶Ø±Ø§ÛŒØ¨ ØªØ§Ø¨Ø¹ Ù‡Ø¯Ù (c):</h5>';
            html += '<div class="matrix-input" style="grid-template-columns: repeat(' + nVars + ', 70px);direction:ltr;">';
            for (let j = 0; j < nVars; j++) {
                html += `<div style="text-align:center;">`;
                html += `<label style="font-size:0.9rem;color:#764ba2;font-weight:600;display:block;margin-bottom:5px;">x<sub>${j+1}</sub></label>`;
                html += `<input type="number" id="manual-c${j}" value="0" step="any" style="text-align:center;">`;
                html += `</div>`;
            }
            html += '</div>';

            html += '<h5 class="mt-3">Ù…Ø§ØªØ±ÛŒØ³ A Ùˆ Ø¨Ø±Ø¯Ø§Ø± b:</h5>';
            html += '<p class="text-muted" style="font-size:0.95rem;border-right:3px solid #ff9800;padding:10px;background:#fff3e0;border-radius:5px;">';
            html += 'âš ï¸ <strong>ØªÙˆØ¬Ù‡:</strong> Ø¯Ø± Ø´Ø±ÙˆØ¹ Ù…Ø³ØªÙ‚ÛŒÙ… Ø§Ø² ÙØ§Ø² Û²ØŒ Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ Ù‚Ø¨Ù„Ø§Ù‹ Ø¨Ù‡ ÙØ±Ù… Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ <strong>AX = b</strong> ØªØ¨Ø¯ÛŒÙ„ Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯. ';
            html += 'Ø¨Ù†Ø§Ø¨Ø±Ø§ÛŒÙ† Ù†ÛŒØ§Ø²ÛŒ Ø¨Ù‡ Ù†ÙˆØ¹ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª (â‰¤, â‰¥, =) Ù†ÛŒØ³Øª. Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ slack Ùˆ surplus Ù‚Ø¨Ù„Ø§Ù‹ Ú¯Ù†Ø¬Ø§Ù†Ø¯Ù‡ Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯.';
            html += '</p>';
            html += '<div class="table-responsive" style="direction:ltr;">';
            html += '<table class="table table-bordered"><thead><tr>';
            for (let j = 0; j < nVars; j++) html += `<th>x${j+1}</th>`;
            html += '<th>b</th></tr></thead><tbody>';
            
            for (let i = 0; i < nCons; i++) {
                html += '<tr>';
                for (let j = 0; j < nVars; j++) {
                    html += `<td><input type="number" id="manual-a${i}_${j}" value="${i===j?'1':'0'}" step="any" style="width:60px;text-align:center;"></td>`;
                }
                html += `<td><input type="number" id="manual-b${i}" value="0" step="any" style="width:60px;text-align:center;"></td>`;
                html += '</tr>';
            }
            html += '</tbody></table></div>';

            html += '<h5 class="mt-3">Ø§Ù†ØªØ®Ø§Ø¨ Ù¾Ø§ÛŒÙ‡ Ø§ÙˆÙ„ÛŒÙ‡:</h5>';
            html += '<p class="text-muted">Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒÛŒ Ú©Ù‡ Ø¯Ø± Ù¾Ø§ÛŒÙ‡ Ø§ÙˆÙ„ÛŒÙ‡ Ù‚Ø±Ø§Ø± Ø¯Ø§Ø±Ù†Ø¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ (Ø¨Ø§ÛŒØ¯ Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ <strong>' + nCons + '</strong> Ù…ØªØºÛŒØ± Ø§Ù†ØªØ®Ø§Ø¨ Ø´ÙˆØ¯):</p>';
            html += '<div class="basis-selector">';
            for (let j = 0; j < nVars; j++) {
                const checked = j >= nVars - nCons ? 'checked' : '';
                html += `<label><input type="checkbox" id="manual-basis${j}" value="${j}" ${checked}> <span>x${j+1}</span></label>`;
            }
            html += '</div>';

            document.getElementById('manual-inputs').innerHTML = html;
        }

        function solveManual() {
            document.getElementById('manual-loading').classList.add('active');
            document.getElementById('manual-output').innerHTML = '';
            
            setTimeout(() => {
                try {
                    const nVars = parseInt(document.getElementById('manual-vars').value);
                    const nCons = parseInt(document.getElementById('manual-constraints').value);
                    const objType = document.querySelector('input[name="manual-objtype"]:checked').value;

                    let c_orig = [];
                    for (let j = 0; j < nVars; j++) {
                        c_orig.push(getNumValue(`manual-c${j}`));
                    }

                    const A = [];
                    const b = [];
                    for (let i = 0; i < nCons; i++) {
                        const row = [];
                        for (let j = 0; j < nVars; j++) {
                            row.push(getNumValue(`manual-a${i}_${j}`));
                        }
                        A.push(row);
                        b.push(getNumValue(`manual-b${i}`));
                    }

                    const basis = [];
                    for (let j = 0; j < nVars; j++) {
                        if (document.getElementById(`manual-basis${j}`).checked) {
                            basis.push(j);
                        }
                    }

                    if (basis.length !== nCons) {
                        alert(`Ù„Ø·ÙØ§Ù‹ Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ ${nCons} Ù…ØªØºÛŒØ± Ø¨Ø±Ø§ÛŒ Ù¾Ø§ÛŒÙ‡ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯!`);
                        document.getElementById('manual-loading').classList.remove('active');
                        return;
                    }

                    // Ù†Ù…Ø§ÛŒØ´ Ù…Ø³Ø¦Ù„Ù‡
                    let displayHtml = '';
                    displayHtml += '<div class="step-box">';
                    displayHtml += '<div class="step-title">ğŸ“‹ ÙØ±Ù…ÙˆÙ„â€ŒØ¨Ù†Ø¯ÛŒ Ù…Ø³Ø¦Ù„Ù‡</div>';
                    displayHtml += '<div style="margin-top:15px;">';
                    displayHtml += '<strong style="color:#764ba2;">Ù…Ø³Ø¦Ù„Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ø®Ø·ÛŒ (ÙØ§Ø² Û² Ù…Ø³ØªÙ‚ÛŒÙ…):</strong>';
                    displayHtml += '<div class="math-block">$$';
                    displayHtml += (objType === 'max' ? '\\text{Maximize } Z = ' : '\\text{Minimize } Z = ');
                    displayHtml += c_orig.map((c, j) => (c >= 0 && j > 0 ? '+' : '') + formatNum(c) + `x_{${j+1}}`).join('');
                    displayHtml += '$$</div>';
                    
                    displayHtml += '<div class="math-block">$$\\text{Subject to: } AX = b$$';
                    displayHtml += '$$A = ' + mat2latex(A) + ', \\quad b = ' + vec2latex(b) + '$$';
                    displayHtml += '$$x_j \\ge 0, \\quad \\forall j$$</div>';
                    displayHtml += '<p style="margin-top:15px;"><strong>Ù¾Ø§ÛŒÙ‡ Ø§ÙˆÙ„ÛŒÙ‡ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡:</strong> $\\{' + basis.map(j => `x_{${j+1}}`).join(', ') + '\\}$</p>';
                    displayHtml += '</div></div>';

                    // Ø§Ú¯Ø± Ù…ÛŒÙ†ÛŒÙ…Ù… Ø§Ø³ØªØŒ Ø¶Ø±Ø§ÛŒØ¨ Ø±Ø§ Ù…Ù†ÙÛŒ Ú©Ù†
                    let c = objType === 'min' ? c_orig.map(x => -x) : c_orig;

                    const result = phaseTwo(A, b, c, basis, nVars, false, [], [], objType);
                    document.getElementById('manual-output').innerHTML = displayHtml + result.html;
                    MathJax.typesetPromise();
                } catch (error) {
                    document.getElementById('manual-output').innerHTML = 
                        `<div class="alert alert-danger">Ø®Ø·Ø§: ${error.message}<br><pre>${error.stack}</pre></div>`;
                }
                document.getElementById('manual-loading').classList.remove('active');
            }, 100);
        }

        // ============ TWO-PHASE REVISED SIMPLEX ============
        function twoPhaseRevised(A_orig, b_orig, c_orig, types, objType = 'max') {
            let html = '';
            
            // ========== Ù†Ù…Ø§ÛŒØ´ Ù…Ø³Ø¦Ù„Ù‡ Ø§ØµÙ„ÛŒ ==========
            html += '<div class="step-box">';
            html += '<div class="step-title">ğŸ“‹ ÙØ±Ù…ÙˆÙ„â€ŒØ¨Ù†Ø¯ÛŒ Ù…Ø³Ø¦Ù„Ù‡</div>';
            html += '<div style="margin-top:15px;">';
            html += '<strong style="color:#764ba2;">Ù…Ø³Ø¦Ù„Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ø®Ø·ÛŒ Ø§ØµÙ„ÛŒ:</strong>';
            html += '<div class="math-block">$$';
            html += (objType === 'max' ? '\\text{Maximize } Z = ' : '\\text{Minimize } Z = ');
            html += c_orig.map((c, j) => (c >= 0 && j > 0 ? '+' : '') + formatNum(c) + `x_{${j+1}}`).join('');
            html += '$$</div>';
            
            html += '<div class="math-block">$$\\text{Subject to:}$$';
            for (let i = 0; i < A_orig.length; i++) {
                html += '$$';
                html += A_orig[i].map((a, j) => (a >= 0 && j > 0 ? '+' : '') + formatNum(a) + `x_{${j+1}}`).join('');
                html += (types[i] === '<=' ? ' \\le ' : types[i] === '>=' ? ' \\ge ' : ' = ') + formatNum(b_orig[i]);
                html += '$$';
            }
            html += '$$x_j \\ge 0, \\quad \\forall j$$</div>';
            html += '</div></div>';
            
            // Ø§Ú¯Ø± Ù…ÛŒÙ†ÛŒÙ…Ù… Ø§Ø³ØªØŒ Ø¶Ø±Ø§ÛŒØ¨ Ø±Ø§ Ù…Ù†ÙÛŒ Ú©Ù†
            const c_input = objType === 'min' ? c_orig.map(x => -x) : c_orig;
            const m = A_orig.length;
            const n_orig = A_orig[0].length;

            // Build augmented system
            let A = A_orig.map(row => [...row]);
            let b = [...b_orig];
            let slackIdx = [];
            let surplusIdx = [];
            let artificialIdx = [];
            let constraintToVarMap = []; // Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ Ù…ØªØºÛŒØ± Ù¾Ø§ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ù…Ø­Ø¯ÙˆØ¯ÛŒØª

            let varNames = [];
            for (let j = 0; j < n_orig; j++) varNames.push(`x_${j+1}`);

            for (let i = 0; i < m; i++) {
                if (types[i] === '<=') {
                    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…ØªØºÛŒØ± slack
                    for (let k = 0; k < m; k++) A[k].push(k === i ? 1 : 0);
                    const slackVarIdx = A[0].length - 1;
                    slackIdx.push(slackVarIdx);
                    varNames.push(`s_${slackIdx.length}`);
                    constraintToVarMap.push(slackVarIdx); // slack Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ù¾Ø§ÛŒÙ‡ Ø§ÙˆÙ„ÛŒÙ‡
                } else if (types[i] === '>=') {
                    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…ØªØºÛŒØ± surplus
                    for (let k = 0; k < m; k++) A[k].push(k === i ? -1 : 0);
                    surplusIdx.push(A[0].length - 1);
                    varNames.push(`s^-_${surplusIdx.length}`);
                    
                    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…ØªØºÛŒØ± artificial
                    for (let k = 0; k < m; k++) A[k].push(k === i ? 1 : 0);
                    const artVarIdx = A[0].length - 1;
                    artificialIdx.push(artVarIdx);
                    varNames.push(`a_${artificialIdx.length}`);
                    constraintToVarMap.push(artVarIdx); // artificial Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ù¾Ø§ÛŒÙ‡ Ø§ÙˆÙ„ÛŒÙ‡
                } else { // '='
                    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…ØªØºÛŒØ± artificial
                    for (let k = 0; k < m; k++) A[k].push(k === i ? 1 : 0);
                    const artVarIdx = A[0].length - 1;
                    artificialIdx.push(artVarIdx);
                    varNames.push(`a_${artificialIdx.length}`);
                    constraintToVarMap.push(artVarIdx); // artificial Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ù¾Ø§ÛŒÙ‡ Ø§ÙˆÙ„ÛŒÙ‡
                }
            }

            const n_total = A[0].length;

            // Ø§Ú¯Ø± Ù‡ÛŒÚ† Ù…ØªØºÛŒØ± Ù…ØµÙ†ÙˆØ¹ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯ØŒ Ù…Ø³ØªÙ‚ÛŒÙ… Ø¨Ù‡ ÙØ§Ø² 2 Ø¨Ø±Ùˆ
            if (artificialIdx.length === 0) {
                html += '<div class="alert alert-info">Ù‡Ù…Ù‡ Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ Ø§Ø² Ù†ÙˆØ¹ â‰¤ Ù‡Ø³ØªÙ†Ø¯. Ù…Ø³ØªÙ‚ÛŒÙ…Ø§Ù‹ ÙØ§Ø² Ø¯ÙˆÙ… Ø´Ø±ÙˆØ¹ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</div>';
                const c_phase2 = new Array(n_total).fill(0);
                for (let j = 0; j < n_orig; j++) c_phase2[j] = c_input[j];
                
                const result = phaseTwo(A, b, c_phase2, constraintToVarMap, n_total, false, [], varNames, objType);
                html += result.html;
                return html;
            }

            // PHASE 1
            html += '<div class="phase-header">ğŸ”µ Ø´Ø±ÙˆØ¹ ÙØ§Ø² Ø§ÙˆÙ„: Ø­Ø°Ù Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ù…ØµÙ†ÙˆØ¹ÛŒ</div>';
            html += '<div class="step-box">';
            html += '<div class="step-title"><span class="step-number">Û±</span>ØªØ¹Ø±ÛŒÙ Ù…Ø³Ø¦Ù„Ù‡ ÙØ§Ø² Ø§ÙˆÙ„</div>';
            html += '<div class="math-block">';
            html += `$$\\min W = ${artificialIdx.map((_, i) => `a_${i+1}`).join(' + ')}$$`;
            html += `$$\\Rightarrow \\max Z = ${artificialIdx.map((_, i) => `-a_${i+1}`).join(' ')}$$`;
            html += '</div>';
            html += '<p class="explanation-text">Ø¯Ø± ÙØ§Ø² Ø§ÙˆÙ„ØŒ Ø¶Ø±Ø§ÛŒØ¨ Ù‡Ù…Ù‡ Ù…ØªØºÛŒØ±Ù‡Ø§ ØµÙØ± Ø§Ø³Øª Ø¨Ù‡ Ø¬Ø² Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ù…ØµÙ†ÙˆØ¹ÛŒ Ú©Ù‡ Ø¶Ø±ÛŒØ¨ -1 Ø¯Ø§Ø±Ù†Ø¯ (Ø¨Ø±Ø§ÛŒ Ù…Ø§Ú©Ø²ÛŒÙ…Ù…â€ŒØ³Ø§Ø²ÛŒ Ù…Ø¹Ø§Ø¯Ù„ Ù…ÛŒÙ†ÛŒÙ…Ù…â€ŒØ³Ø§Ø²ÛŒ).</p>';
            html += '<p class="explanation-text"><strong>Ù¾Ø§ÛŒÙ‡ Ø§ÙˆÙ„ÛŒÙ‡ ÙØ§Ø² Û±:</strong> $\\{' + constraintToVarMap.map(i => varNames[i]).join(', ') + '\\}$</p>';
            html += '</div>';

            const c_phase1 = new Array(n_total).fill(0);
            for (const idx of artificialIdx) c_phase1[idx] = -1;

            const result1 = phaseTwo(A, b, c_phase1, constraintToVarMap, n_total, true, artificialIdx, varNames, 'max');
            html += result1.html;

            if (!result1.optimal) {
                html += '<div class="alert alert-warning">ÙØ§Ø² Ø§ÙˆÙ„ Ø¨Ù‡ Ø¬ÙˆØ§Ø¨ Ø¨Ù‡ÛŒÙ†Ù‡ Ù†Ø±Ø³ÛŒØ¯.</div>';
                return html;
            }

            // Check feasibility
            const finalBasis1 = result1.finalBasis;
            const B_final1 = finalBasis1.map(j => getCol(A, j));
            const B_mat_final1 = B_final1[0].map((_, i) => B_final1.map(col => col[i]));
            const B_inv_final1 = math.inv(B_mat_final1);
            const X_B_final1 = math.multiply(B_inv_final1, b);
            const C_B_final1 = finalBasis1.map(j => c_phase1[j]);
            const W_final = -math.dot(C_B_final1, X_B_final1); // Ù…Ù†ÙÛŒ Ú†ÙˆÙ† max(-W) Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´Ø¯Ù‡

            if (W_final > EPSILON) {
                html += '<div class="result-box infeasible-box">';
                html += '<h3>âš ï¸ Ù…Ø³Ø¦Ù„Ù‡ Ù†Ø´Ø¯Ù†ÛŒ Ø§Ø³Øª!</h3>';
                html += `<p>Ù…Ù‚Ø¯Ø§Ø± W = ${formatNum(W_final)} > 0</p>`;
                html += '<p>Ø¬ÙˆØ§Ø¨ Ø´Ø¯Ù†ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</p>';
                html += '</div>';
                return html;
            }

            html += '<div class="math-block success">';
            html += '<p style="margin:0;font-size:1.2rem;font-weight:600;">âœ… ÙØ§Ø² Ø§ÙˆÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù¾Ø§ÛŒØ§Ù† ÛŒØ§ÙØª: $W = 0$</p>';
            html += '</div>';

            // PHASE 2
            html += '<div class="phase-header">ğŸŸ¢ Ø´Ø±ÙˆØ¹ ÙØ§Ø² Ø¯ÙˆÙ…: Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ ØªØ§Ø¨Ø¹ Ù‡Ø¯Ù Ø§ØµÙ„ÛŒ</div>';
            
            // Drop artificial columns from A and update basis indices
            const A_phase2 = A.map(row => row.filter((_, j) => !artificialIdx.includes(j)));
            const c_phase2 = [];
            let newIdx = 0;
            const oldToNew = {};
            for (let j = 0; j < n_total; j++) {
                if (!artificialIdx.includes(j)) {
                    oldToNew[j] = newIdx++;
                    if (j < n_orig) {
                        c_phase2.push(c_input[j]);
                    } else {
                        c_phase2.push(0);
                    }
                }
            }
            
            // Map final basis from phase 1 (remove artificials)
            const basisPhase2 = finalBasis1.filter(idx => !artificialIdx.includes(idx)).map(idx => oldToNew[idx]);
            const varNamesPhase2 = varNames.filter((_, j) => !artificialIdx.includes(j));

            html += '<div class="step-box">';
            html += '<div class="step-title"><span class="step-number">Û±</span>Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¶Ø±Ø§ÛŒØ¨ ØªØ§Ø¨Ø¹ Ù‡Ø¯Ù Ø§ØµÙ„ÛŒ</div>';
            html += '<div class="math-block">';
            html += `$$c^T = ${vec2latex([c_phase2])}^T$$`;
            html += '</div>';
            html += '<p class="explanation-text"><strong>Ù¾Ø§ÛŒÙ‡ Ø§ÙˆÙ„ÛŒÙ‡ ÙØ§Ø² Û²:</strong> $\\{' + basisPhase2.map(i => varNamesPhase2[i]).join(', ') + '\\}$</p>';
            html += '</div>';

            const result2 = phaseTwo(A_phase2, b, c_phase2, basisPhase2, c_phase2.length, false, [], varNamesPhase2, objType);
            html += result2.html;

            return html;
        }

        // ============ PHASE TWO (REVISED SIMPLEX) ============
        function phaseTwo(A, b, c, initialBasis, nVars, isPhase1 = false, artificialIdx = [], varNames = [], objType = 'max') {
            let html = '';
            const m = A.length;
            const n = A[0].length;
            
            if (varNames.length === 0) {
                for (let j = 0; j < n; j++) varNames.push(`x_{${j+1}}`);
            }

            let basis = [...initialBasis];
            let iter = 0;
            const maxIter = 50;
            let optimal = false;

            while (iter < maxIter) {
                iter++;
                html += `<div class="step-box"><div class="step-title" style="background:#764ba2;color:white;padding:10px;border-radius:5px;">ØªÚ©Ø±Ø§Ø± ${iter}</div>`;

                // Step 1: Extract B
                html += '<div class="step-box">';
                html += '<div class="step-title"><span class="step-number">Û±</span>Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…Ø§ØªØ±ÛŒØ³ Ù¾Ø§ÛŒÙ‡ (B)</div>';
                html += '<p class="explanation-text"><strong>Ù¾Ø§ÛŒÙ‡ ÙØ¹Ù„ÛŒ:</strong> $\\{' + basis.map(i => varNames[i]).join(', ') + '\\}$</p>';
                
                const B = basis.map(j => getCol(A, j));
                const B_mat = B[0].map((_, i) => B.map(col => col[i]));
                html += '<div class="math-block">$$B = ' + mat2latex(B_mat) + '$$</div>';
                html += '</div>';

                // Step 2: Compute B^{-1}
                html += '<div class="step-box">';
                html += '<div class="step-title"><span class="step-number">Û²</span>Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø¹Ú©ÙˆØ³ Ù¾Ø§ÛŒÙ‡ ($B^{-1}$)</div>';
                const B_inv = math.inv(B_mat);
                html += '<div class="math-block highlight">$$B^{-1} = ' + mat2latex(B_inv) + '$$</div>';
                html += '</div>';

                // Step 3: Compute X_B
                html += '<div class="step-box">';
                html += '<div class="step-title"><span class="step-number">Û³</span>Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ù‚Ø§Ø¯ÛŒØ± Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡ ($X_B = B^{-1}b$)</div>';
                const X_B = math.multiply(B_inv, b);
                html += '<div class="math-block highlight">';
                html += `$$X_B = B^{-1} \\cdot b = ${mat2latex(B_inv)} \\times ${vec2latex(b)} = ${vec2latex(X_B)}$$`;
                html += '</div></div>';

                // Step 4: Current Z
                const C_B = basis.map(j => c[j]);
                const Z_curr = math.dot(C_B, X_B);
                html += '<div class="step-box">';
                html += '<div class="step-title"><span class="step-number">Û´</span>Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ù‚Ø¯Ø§Ø± ÙØ¹Ù„ÛŒ ØªØ§Ø¨Ø¹ Ù‡Ø¯Ù</div>';
                html += '<div class="math-block">';
                html += `$$C_B^T = ${vec2latex([C_B])}^T$$`;
                html += `$$${isPhase1 ? 'W' : 'Z'} = C_B^T \\cdot X_B = ${formatNum(Z_curr)}$$`;
                html += '</div></div>';

                // Step 5: Reduced costs
                html += '<div class="step-box">';
                html += '<div class="step-title"><span class="step-number">Ûµ</span>Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ù‡Ø´ ÛŒØ§ÙØªÙ‡ ($\\bar{C}_j$)</div>';
                
                const nonBasis = [];
                for (let j = 0; j < n; j++) {
                    if (!basis.includes(j)) nonBasis.push(j);
                }

                const reducedCosts = [];
                html += '<div style="direction:ltr;text-align:left;margin:10px 0;">';
                for (const j of nonBasis) {
                    const P_j = getCol(A, j);
                    const y = math.multiply(math.transpose(B_inv), basis.map(i => c[i]));
                    const rc = c[j] - math.dot(y, P_j);
                    reducedCosts.push(rc);
                    html += `<p style="margin:5px 0;">$\\bar{C}_{${varNames[j]}} = ${formatNum(c[j])} - ${vec2latex([y])}^T \\cdot ${vec2latex(P_j)} = ${formatNum(rc)}$</p>`;
                }
                html += '</div>';

                // Optimality check
                const positiveIdx = reducedCosts.map((rc, i) => rc > EPSILON ? i : -1).filter(i => i >= 0);
                
                if (positiveIdx.length === 0) {
                    html += '<div class="math-block success">';
                    html += '<p style="margin:0;font-size:1.1rem;font-weight:600;"><strong>âœ“ Ù‡Ù…Ù‡</strong> $\\bar{C}_j \\le 0$ <strong>â†’ Ø¬ÙˆØ§Ø¨ Ø¨Ù‡ÛŒÙ†Ù‡ Ø§Ø³Øª!</strong></p>';
                    html += '</div>';
                    html += '</div></div>';
                    optimal = true;
                    break;
                }

                // Step 6: Entering variable
                let enterLocalIdx = positiveIdx[0];
                for (const idx of positiveIdx) {
                    if (reducedCosts[idx] > reducedCosts[enterLocalIdx]) enterLocalIdx = idx;
                }
                const enterGlobalIdx = nonBasis[enterLocalIdx];

                html += '<div class="math-block warning">';
                html += '<p style="margin:0 0 8px 0;font-size:1.05rem;"><strong>$\\exists \\bar{C}_j > 0$ â†’ Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ</strong></p>';
                html += `<p style="margin:0 0 8px 0;"><strong>Ø¨ÛŒØ´ØªØ±ÛŒÙ†:</strong> $\\bar{C}_{${varNames[enterGlobalIdx]}} = ${formatNum(reducedCosts[enterLocalIdx])}$</p>`;
                html += `<div style="border:2px solid #27ae60;background-color:#d5f4e6;padding:10px;border-radius:5px;margin:8px 0;display:inline-block;"><strong>Ù…ØªØºÛŒØ± ÙˆØ§Ø±Ø¯Ø´ÙˆÙ†Ø¯Ù‡:</strong> $${varNames[enterGlobalIdx]}$</div>`;
                html += '</div></div>';

                // Step 7: Compute direction
                html += '<div class="step-box">';
                html += '<div class="step-title"><span class="step-number">Û¶</span>Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¨Ø±Ø¯Ø§Ø± Ø¬Ù‡Øª ($d = B^{-1} P_j$)</div>';
                const P_enter = getCol(A, enterGlobalIdx);
                const d = math.multiply(B_inv, P_enter);
                html += '<div class="math-block">';
                html += `$$P_{${varNames[enterGlobalIdx]}} = ${vec2latex(P_enter)}$$`;
                html += `<p style="margin:8px 0 0 0;font-size:0.9rem;color:#666;">(Ø³ØªÙˆÙ† ${enterGlobalIdx+1} Ø§Ø² $A$)</p>`;
                html += '</div>';
                html += '<div class="math-block highlight">';
                html += `$$d = B^{-1} \\cdot P_{${varNames[enterGlobalIdx]}} = ${mat2latex(B_inv)} \\times ${vec2latex(P_enter)} = ${vec2latex(d)}$$`;
                html += '</div></div>';

                // Step 8: Ratio test
                html += '<div class="step-box">';
                html += '<div class="step-title"><span class="step-number">Û·</span>Ø¢Ø²Ù…ÙˆÙ† Ù†Ø³Ø¨Øª (Ratio Test)</div>';
                html += '<div class="math-block">$$\\theta = \\min\\left\\{\\frac{X_{B_i}}{d_i} \\; | \\; d_i > 0\\right\\}$$</div>';

                const ratios = [];
                for (let i = 0; i < m; i++) {
                    if (d[i] > EPSILON) {
                        ratios.push({idx: i, bVar: basis[i], xb: X_B[i], di: d[i], ratio: X_B[i] / d[i]});
                    }
                }

                if (ratios.length === 0) {
                    html += '<div class="math-block" style="background:#fed7d7;border-color:#c53030;">';
                    html += '<p style="margin:0;font-size:1.1rem;font-weight:600;color:#c53030;"><strong>âš  Ù‡Ù…Ù‡</strong> $d_i \\le 0$ <strong>â†’ Ù…Ø³Ø¦Ù„Ù‡ Ù†Ø§Ù…Ø­Ø¯ÙˆØ¯!</strong></p>';
                    html += '</div></div></div>';
                    break;
                }

                let minRatioObj = ratios[0];
                for (const r of ratios) {
                    if (r.ratio < minRatioObj.ratio - EPSILON) minRatioObj = r;
                }

                html += '<table class="ratio-table"><thead><tr><th>Ù…ØªØºÛŒØ± Ù¾Ø§ÛŒÙ‡</th><th>$X_{B_i}$</th><th>$d_i$</th><th>Ù†Ø³Ø¨Øª</th></tr></thead><tbody>';
                for (let i = 0; i < m; i++) {
                    const isValid = d[i] > EPSILON;
                    const isMin = ratios.some(r => r.idx === i && r === minRatioObj);
                    const cls = isMin ? 'selected' : (!isValid ? 'invalid' : '');
                    html += `<tr class="${cls}">`;
                    html += `<td>$${varNames[basis[i]]}$</td>`;
                    html += `<td>$${formatNum(X_B[i])}$</td>`;
                    html += `<td>$${formatNum(d[i])}$</td>`;
                    if (isValid) {
                        html += `<td>$\\frac{${formatNum(X_B[i])}}{${formatNum(d[i])}} = ${formatNum(X_B[i]/d[i])}$</td>`;
                    } else {
                        html += `<td>â€”</td>`;
                    }
                    html += '</tr>';
                }
                html += '</tbody></table>';

                html += '<div class="math-block success">';
                html += `$$\\theta^* = ${formatNum(minRatioObj.ratio)}$$`;
                html += `<div style="border:2px solid #e74c3c;background-color:#ffe6e6;padding:10px;border-radius:5px;margin:8px 0;display:inline-block;"><strong>Ù…ØªØºÛŒØ± Ø®Ø§Ø±Ø¬â€ŒØ´ÙˆÙ†Ø¯Ù‡:</strong> $${varNames[minRatioObj.bVar]}$</div>`;
                html += '</div></div>';

                // Step 9: Update basis
                const leavingIdx = minRatioObj.idx;
                const oldBasisVar = basis[leavingIdx];
                basis[leavingIdx] = enterGlobalIdx;

                html += '<div class="step-box">';
                html += '<div class="step-title"><span class="step-number">Û¸</span>Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù¾Ø§ÛŒÙ‡</div>';
                html += '<div style="display:flex;justify-content:center;align-items:center;gap:20px;margin:15px 0;">';
                html += `<div style="border:2px solid #e74c3c;background-color:#ffe6e6;padding:12px 20px;border-radius:8px;"><strong>Ø®Ø±ÙˆØ¬:</strong> <span class="leaving-var" style="font-size:1.2rem;margin-right:8px;">$${varNames[oldBasisVar]}$</span></div>`;
                html += '<div style="font-size:1.5rem;">$\\longleftrightarrow$</div>';
                html += `<div style="border:2px solid #27ae60;background-color:#d5f4e6;padding:12px 20px;border-radius:8px;"><strong>ÙˆØ±ÙˆØ¯:</strong> <span class="entering-var" style="font-size:1.2rem;margin-right:8px;">$${varNames[enterGlobalIdx]}$</span></div>`;
                html += '</div>';
                html += '<p class="explanation-text"><strong>Ù¾Ø§ÛŒÙ‡ Ø¬Ø¯ÛŒØ¯:</strong> $\\{' + basis.map(i => varNames[i]).join(', ') + '\\}$</p>';
                html += '</div></div>';
            }

            if (optimal) {
                const B_final = basis.map(j => getCol(A, j));
                const B_mat_final = B_final[0].map((_, i) => B_final.map(col => col[i]));
                const B_inv_final = math.inv(B_mat_final);
                const X_B_final = math.multiply(B_inv_final, b);
                const C_B_final = basis.map(j => c[j]);
                const Z_final = math.dot(C_B_final, X_B_final);

                html += '<div class="result-box">';
                html += `<h3>${isPhase1 ? 'âœ… ÙØ§Ø² Ø§ÙˆÙ„ Ú©Ø§Ù…Ù„ Ø´Ø¯' : 'ğŸ‰ Ø¬ÙˆØ§Ø¨ Ø¨Ù‡ÛŒÙ†Ù‡'}</h3>`;
                const displayZ = (objType === 'min' && !isPhase1) ? -Z_final : Z_final;
                html += `<div style="font-size:1.8rem;font-weight:bold;margin:15px 0;">$${isPhase1 ? 'W' : 'Z'}^* = ${formatNum(displayZ)}$</div>`;
                html += '<div style="background:rgba(255,255,255,0.3);padding:15px;border-radius:8px;margin:15px 0;">';
                for (let i = 0; i < m; i++) {
                    html += `<p style="margin:5px 0;font-size:1.1rem;">$${varNames[basis[i]]} = ${formatNum(X_B_final[i])}$</p>`;
                }
                html += '</div>';
                html += `<p class="explanation-text text-center mt-3"><strong>ØªØ¹Ø¯Ø§Ø¯ ØªÚ©Ø±Ø§Ø±Ù‡Ø§:</strong> ${iter} | <strong>Ù¾Ø§ÛŒÙ‡ Ù†Ù‡Ø§ÛŒÛŒ:</strong> $\\{${basis.map(i => varNames[i]).join(', ')}\\}$</p>`;
                html += '</div>';
            } else {
                html += '<div class="alert alert-warning">Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… Ù¾Ø³ Ø§Ø² ' + maxIter + ' ØªÚ©Ø±Ø§Ø± Ù…ØªÙˆÙ‚Ù Ø´Ø¯.</div>';
            }

            // Return object with html, finalBasis, and optimal flag
            return { html: html, finalBasis: basis, optimal: optimal };
        }

        // ============ EXAMPLE FUNCTIONS ============
        
        // AUTO MODE EXAMPLES
        function loadAutoExample1() {
            // Ù…Ø«Ø§Ù„ Ø¨Ø§ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª >= (Ù†ÛŒØ§Ø² Ø¨Ù‡ ÙØ§Ø² 1)
            document.getElementById('auto-vars').value = 2;
            document.getElementById('auto-constraints').value = 2;
            generateAutoInputs();
            
            setTimeout(() => {
                document.querySelector('input[name="auto-objtype"][value="max"]').checked = true;
                document.getElementById('auto-c0').value = 3;
                document.getElementById('auto-c1').value = 5;
                
                document.getElementById('auto-a0_0').value = 1;
                document.getElementById('auto-a0_1').value = 0;
                document.getElementById('auto-type0').value = '>=';
                document.getElementById('auto-b0').value = 4;
                
                document.getElementById('auto-a1_0').value = 0;
                document.getElementById('auto-a1_1').value = 2;
                document.getElementById('auto-type1').value = '>=';
                document.getElementById('auto-b1').value = 12;
            }, 100);
        }

        function loadAutoExample2() {
            // Ù…Ø«Ø§Ù„ Ø¨Ø§ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª <= (Ù…Ø³ØªÙ‚ÛŒÙ… ÙØ§Ø² 2)
            document.getElementById('auto-vars').value = 2;
            document.getElementById('auto-constraints').value = 2;
            generateAutoInputs();
            
            setTimeout(() => {
                document.querySelector('input[name="auto-objtype"][value="max"]').checked = true;
                document.getElementById('auto-c0').value = 3;
                document.getElementById('auto-c1').value = 2;
                
                document.getElementById('auto-a0_0').value = 2;
                document.getElementById('auto-a0_1').value = 1;
                document.getElementById('auto-type0').value = '<=';
                document.getElementById('auto-b0').value = 18;
                
                document.getElementById('auto-a1_0').value = 1;
                document.getElementById('auto-a1_1').value = 1;
                document.getElementById('auto-type1').value = '<=';
                document.getElementById('auto-b1').value = 10;
            }, 100);
        }

        function loadAutoExample3() {
            // Ù…Ø«Ø§Ù„ ØªØ±Ú©ÛŒØ¨ÛŒ: <=, =, >= (Ù‡Ù…Ù‡ Ø§Ù†ÙˆØ§Ø¹ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª)
            document.getElementById('auto-vars').value = 2;
            document.getElementById('auto-constraints').value = 3;
            generateAutoInputs();
            
            setTimeout(() => {
                document.querySelector('input[name="auto-objtype"][value="max"]').checked = true;
                document.getElementById('auto-c0').value = 2;
                document.getElementById('auto-c1').value = 3;
                
                document.getElementById('auto-a0_0').value = 1;
                document.getElementById('auto-a0_1').value = 1;
                document.getElementById('auto-type0').value = '<=';
                document.getElementById('auto-b0').value = 10;
                
                document.getElementById('auto-a1_0').value = 1;
                document.getElementById('auto-a1_1').value = 0;
                document.getElementById('auto-type1').value = '=';
                document.getElementById('auto-b1').value = 3;
                
                document.getElementById('auto-a2_0').value = 0;
                document.getElementById('auto-a2_1').value = 1;
                document.getElementById('auto-type2').value = '>=';
                document.getElementById('auto-b2').value = 2;
            }, 100);
        }

        // MANUAL MODE EXAMPLES
        function loadManualExample1() {
            // Ù…Ø«Ø§Ù„ Ø³Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ ÙØ§Ø² 2
            document.getElementById('manual-vars').value = 4;
            document.getElementById('manual-constraints').value = 2;
            generateManualInputs();
            
            setTimeout(() => {
                document.querySelector('input[name="manual-objtype"][value="max"]').checked = true;
                document.getElementById('manual-c0').value = 3;
                document.getElementById('manual-c1').value = 2;
                document.getElementById('manual-c2').value = 0;
                document.getElementById('manual-c3').value = 0;
                
                // Ù…Ø§ØªØ±ÛŒØ³ A
                document.getElementById('manual-a0_0').value = 2;
                document.getElementById('manual-a0_1').value = 1;
                document.getElementById('manual-a0_2').value = 1;
                document.getElementById('manual-a0_3').value = 0;
                document.getElementById('manual-b0').value = 18;
                
                document.getElementById('manual-a1_0').value = 1;
                document.getElementById('manual-a1_1').value = 1;
                document.getElementById('manual-a1_2').value = 0;
                document.getElementById('manual-a1_3').value = 1;
                document.getElementById('manual-b1').value = 10;
                
                // Ù¾Ø§ÛŒÙ‡ Ø§ÙˆÙ„ÛŒÙ‡: x3, x4
                document.getElementById('manual-basis0').checked = false;
                document.getElementById('manual-basis1').checked = false;
                document.getElementById('manual-basis2').checked = true;
                document.getElementById('manual-basis3').checked = true;
            }, 100);
        }

        function loadManualExample2() {
            // Ù…Ø«Ø§Ù„ Ù¾ÛŒÚ†ÛŒØ¯Ù‡â€ŒØªØ± (Ú†Ù†Ø¯ ØªÚ©Ø±Ø§Ø±)
            document.getElementById('manual-vars').value = 5;
            document.getElementById('manual-constraints').value = 2;
            generateManualInputs();
            
            setTimeout(() => {
                document.querySelector('input[name="manual-objtype"][value="max"]').checked = true;
                document.getElementById('manual-c0').value = 5;
                document.getElementById('manual-c1').value = 4;
                document.getElementById('manual-c2').value = 0;
                document.getElementById('manual-c3').value = 0;
                document.getElementById('manual-c4').value = 0;
                
                // Ù…Ø§ØªØ±ÛŒØ³ A: Ù¾Ø§ÛŒÙ‡ Ø§ÙˆÙ„ÛŒÙ‡ Ø¶Ø¹ÛŒÙ Ú©Ù‡ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ú†Ù†Ø¯ ØªÚ©Ø±Ø§Ø± Ø¯Ø§Ø±Ø¯
                document.getElementById('manual-a0_0').value = 6;
                document.getElementById('manual-a0_1').value = 4;
                document.getElementById('manual-a0_2').value = 1;
                document.getElementById('manual-a0_3').value = 0;
                document.getElementById('manual-a0_4').value = 0;
                document.getElementById('manual-b0').value = 24;
                
                document.getElementById('manual-a1_0').value = 1;
                document.getElementById('manual-a1_1').value = 2;
                document.getElementById('manual-a1_2').value = 0;
                document.getElementById('manual-a1_3').value = 1;
                document.getElementById('manual-a1_4').value = 0;
                document.getElementById('manual-b1').value = 6;
                
                // Ù¾Ø§ÛŒÙ‡ Ø§ÙˆÙ„ÛŒÙ‡: x3, x4 (slack variables - Ù¾Ø§ÛŒÙ‡ Ø¶Ø¹ÛŒÙ)
                document.getElementById('manual-basis0').checked = false;
                document.getElementById('manual-basis1').checked = false;
                document.getElementById('manual-basis2').checked = true;
                document.getElementById('manual-basis3').checked = true;
                document.getElementById('manual-basis4').checked = false;
            }, 100);
        }

        // Initialize on load
        window.onload = () => {
            generateAutoInputs();
            generateManualInputs();
        };
    </script>
</body>
</html>
